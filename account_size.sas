data account_size;
set exchange.T_1001d;
date=mdy(input(substr(compress(F1_T1001D),5,2),6.),input(substr(compress(F1_T1001D),7,2),6.),input(substr(compress(F1_T1001D),1,4),6.));
s10k=F8_T1001D+F11_T1001D;
l10k_s100k=F14_T1001D+F17_T1001D;
l100k_s1m=F20_T1001D+F23_T1001D;
s50k=F8_T1001D+F11_T1001D+F14_T1001D;
l50k_s500k=F17_T1001D+F20_T1001D;
l500k_s5m=F23_T1001D+F26_T1001D;
format date date.;
rename F2_T1001D=stock_code F8_T1001D=S1k F11_T1001D=L1k_S10k F14_T1001D=L10k_S50k F17_T1001D=L50k_S100k F20_T1001D=L100k_S500k F23_T1001D=L500k_S1m F26_T1001D=L1m_S5m F29_T1001D=L5m_S10m F32_T1001D=L10m;
keep F2_T1001D date F8_T1001D F11_T1001D F14_T1001D F17_T1001D F20_T1001D F23_T1001D F26_T1001D F29_T1001D F32_T1001D s10k l10k_s100k l100k_s1m s50k l50k_s500k l500k_s5m;
run;

data account_size;
set account_size;
change_s1k=s1k/lag(s1k)-1;
change_l1k_s10k=l1k_s10k/lag(l1k_s10k)-1;
change_l10k_s50k=l10k_s50k/lag(l10k_s50k)-1;
change_l50k_s100k=l50k_s100k/lag(l50k_s100k)-1;
change_l100k_s500k=l100k_s500k/lag(l100k_s500k)-1;
change_l500k_s1m=l500k_s1m/lag(l500k_s1m)-1;
change_l1m_s5m=l1m_s5m/lag(l1m_s5m)-1;
change_l5m_s10m=l5m_s10m/lag(l5m_s10m)-1;
change_l10m=l10m/lag(l10m)-1;
change_s10k=s10k/lag(s10k)-1;
change_l10k_s100k=l10k_s100k/lag(l10k_s100k)-1;
change_l100k_s1m=l100k_s1m/lag(l100k_s1m)-1;
change_s50k=s50k/lag(s50k)-1;
change_l50k_s500k=l50k_s500k/lag(l50k_s500k)-1;
change_l500k_s5m=l500k_s5m/lag(l500k_s5m)-1;
run;

proc sort data=account_size;
by stock_code date;
run;

data account_size;
set account_size;
by stock_code date;
if first.stock_code then do;
change_s1k=.;
change_l1k_s10k=.;
change_l10k_s50k=.;
change_l50k_s100k=.;
change_l100k_s500k=.;
change_l500k_s1m=.;
change_l1m_s5m=.;
change_l5m_s10m=.;
change_l10m=.;
change_s10k=.;
change_l10k_s100k=.;
change_l100k_s1m=.;
change_s50k=.;
change_l50k_s500k=.;
change_l500k_s5m=.;
end;
run;

data aaa;
set account_size;
by stock_code date;
if change_l1m_s5m=.;
if change_l5m_s10m=.;
if change_l10m=.;
if not first.stock_code;
run;
